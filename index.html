<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR Σκηνή με GLB</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-aabb-collider-component@3.2.0/dist/aframe-aabb-collider-component.min.js"></script>
  <style>body{margin:0;}</style>
</head>
<body>
<a-scene vr-mode-ui="enabled: true" embedded>
  <a-assets>
    <audio id="catchSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5b2a31c3c2.mp3?filename=pop-94319.mp3"></audio>
    <a-asset-item id="tree" src="https://pda21087.github.io/low_poly_tree_scene_free/linden_tree.glb"></a-asset-item>
    <a-asset-item id="butterfly" src="https://pda21087.github.io/animated_butterfly/animated_butterfly.glb"></a-asset-item>
  </a-assets>

  <a-sky color="#87CEEB"></a-sky>
  <a-plane rotation="-90 0 0" width="80" height="80" color="#2e8b57"></a-plane>

  <a-entity gltf-model="#tree" scale="2 2 2" position="0 0 -10"></a-entity>

  <a-entity id="butterflies">
    <a-entity gltf-model="#butterfly" scale="0.5 0.5 0.5" position="-2 1.5 -4" animation-mixer class="butterfly"></a-entity>
    <a-entity gltf-model="#butterfly" scale="0.5 0.5 0.5" position="2 1.2 -5" animation-mixer class="butterfly"></a-entity>
    <a-entity gltf-model="#butterfly" scale="0.5 0.5 0.5" position="0 1.8 -6" animation-mixer class="butterfly"></a-entity>
    <a-entity gltf-model="#butterfly" scale="0.5 0.5 0.5" position="3 1.6 -7" animation-mixer class="butterfly"></a-entity>
    <a-entity gltf-model="#butterfly" scale="0.5 0.5 0.5" position="-3 1.4 -5" animation-mixer class="butterfly"></a-entity>
  </a-entity>

  <a-entity id="player" position="0 1.6 3" wasd-controls look-controls>
    <a-entity camera></a-entity>
    <a-entity id="net"
              geometry="primitive: cylinder; radius:0.16; height:1.1"
              material="color: #f0f0f0; opacity:0.9"
              position="0 -0.15 -0.8"
              rotation="-20 0 0"
              aabb-collider="objects: .butterfly"
              sound="src: #catchSound; on: playSoundCustom">
      <a-ring position="0 0.55 0.05" rotation="-90 0 0" radius-inner="0.02" radius-outer="0.04"></a-ring>
    </a-entity>
  </a-entity>

  <a-entity light="type: ambient; intensity: 0.6"></a-entity>
  <a-entity light="type: directional; intensity: 0.8" position="0 10 5"></a-entity>
</a-scene>

<script>
  var net = document.querySelector('#net');
  net.addEventListener('hitstart', function (evt) {
    var hit = evt.detail && evt.detail.el;
    if(!hit) return;
    var audio = new Audio(document.querySelector('#catchSound').src);
    audio.volume = 0.9; 
    audio.play().catch(()=>{});
    hit.setAttribute('animation__fade','property: scale; to: 0.01 0.01 0.01; dur: 350; easing: easeInQuad');
    setTimeout(()=>{if(hit && hit.parentElement) hit.parentElement.removeChild(hit)}, 380);
  });

  function randomPosition(minX, maxX, minY, maxY, minZ, maxZ){
    return { x: Math.random()*(maxX-minX)+minX, y: Math.random()*(maxY-minY)+minY, z: Math.random()*(maxZ-minZ)+minZ };
  }

  var butterflies = document.querySelectorAll('.butterfly');

  butterflies.forEach(function(butterfly){
    function moveButterfly(){
      var pos = randomPosition(-8,8,1,3,-15,-5);
      butterfly.setAttribute('animation__move', { property: 'position', to: `${pos.x} ${pos.y} ${pos.z}`, dur: 4000+Math.random()*2000, easing: 'easeInOutSine' });
      butterfly.setAttribute('animation__float', { property: 'position', to: `${pos.x} ${pos.y+0.2} ${pos.z}`, dur: 2000+Math.random()*1000, direction:'alternate', loop:true, easing:'easeInOutSine' });
      butterfly.setAttribute('animation__rotate', { property: 'rotation', to: `0 ${Math.random()*360} 0`, dur: 3000+Math.random()*2000, loop:true, easing:'linear' });
    }
    moveButterfly();
    setInterval(moveButterfly, 5000+Math.random()*2000);
  });
</script>
</body>
</html>

